<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chicago Trip Itinerary with Maps</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .container {
            max-width: 1024px;
            margin: auto;
            padding: 20px;
        }
        .day-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #2c3e50;
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            background-color: #f1f5f9;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .map-container {
            width: 100%;
            height: 400px;
            margin-bottom: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
            border: 1px solid #e2e8f0;
        }
        .itinerary-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 10px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            overflow: hidden;
        }
        .itinerary-table th, .itinerary-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        .itinerary-table th {
            background-color: #f1f5f9;
            font-weight: 600;
            color: #334155;
            padding: 14px 15px;
        }
        .itinerary-table td {
            color: #4a5568;
        }
        .itinerary-table tr:last-child td {
            border-bottom: none;
        }
        .itinerary-table tr:hover {
            background-color: #f8fafc;
        }
        .text-center {
            text-align: center;
        }
        .map-label {
            font-size: 0.875rem;
            color: #718096;
            margin-top: 5px;
            display: block;
            text-align: center;
        }
        .day-card {
            margin-bottom: 40px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            padding: 20px;
            border: 1px solid #e2e8f0;
        }
        .button-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
            justify-content: center;
        }
        .page-title {
            font-size: 2.25rem;
            font-weight: 700;
            color: #1e293b;
            text-align: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e2e8f0;
        }
        .table-container {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin-bottom: 15px;
            border-radius: 10px;
        }
        @media (max-width: 768px) {
            .button-container {
                flex-direction: column;
            }
            .map-container {
                height: 300px;
            }
            .itinerary-table {
                font-size: 0.875rem;
                min-width: 650px;
            }
        }
        .leaflet-marker-icon {
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: white;
        }
        .number-col {
            width: 40px;
            text-align: center;
        }
        .map-link {
            display: inline-block;
            padding: 5px 10px;
            background-color: #3b82f6;
            color: white;
            border-radius: 4px;
            text-decoration: none;
            font-size: 12px;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        
        .map-link:hover {
            background-color: #2563eb;
        }
        
        .map-link-col {
            width: 60px;
            text-align: center;
        }
        .place-link, .gantt-link {
            color: inherit;
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .place-link:hover {
            color: #3b82f6;
            text-decoration: underline;
        }
        
        .gantt-link {
            color: white;
        }
        
        .gantt-link:hover {
            text-decoration: underline;
        }
    </style>
    <script>
        let map;
        let dayMarkers = {};
        let chicagoRiverPolyline;
        let dayRoutes = {};
        let tripData = null;
        let currentDay = 1;

        // Embed the JSON data directly instead of fetching it
        function fetchTripData() {
            // Embedded trip data
            tripData = {
              "tripTitle": "Chicago Trip Itinerary 2025",
              "days": [
                {
                  "id": 1,
                  "title": "Day 1: Downtown Chicago",
                  "color": "#3b82f6",
                  "mapView": {
                    "lat": 41.8825,
                    "lng": -87.6233,
                    "zoom": 13
                  },
                  "activities": [
                    {
                      "id": 1,
                      "time": "9:00 AM - 11:00 AM",
                      "timeStart": 9,
                      "timeEnd": 11,
                      "activity": "Visit",
                      "place": "Millennium Park & The Bean",
                      "address": "201 E Randolph St, Chicago, IL 60602",
                      "note": "Iconic Chicago landmark",
                      "coordinates": [41.8826, -87.6233]
                    },
                    {
                      "id": 2,
                      "time": "11:30 AM - 1:30 PM",
                      "timeStart": 11.5,
                      "timeEnd": 13.5,
                      "activity": "Lunch",
                      "place": "The Purple Pig",
                      "address": "444 N Michigan Ave, Chicago, IL 60611",
                      "note": "Mediterranean cuisine",
                      "coordinates": [41.8909, -87.6246]
                    },
                    {
                      "id": 3,
                      "time": "2:00 PM - 4:00 PM",
                      "timeStart": 14,
                      "timeEnd": 16,
                      "activity": "Tour",
                      "place": "Chicago Architecture River Cruise",
                      "address": "112 E Wacker Dr, Chicago, IL 60601",
                      "note": "Best way to see city architecture",
                      "coordinates": [41.8875, -87.6264],
                      "isRiver": true,
                      "riverCoordinates": [
                        [41.8875, -87.6264],
                        [41.8882, -87.6289],
                        [41.8891, -87.6321],
                        [41.8898, -87.6352],
                        [41.8898, -87.6387],
                        [41.8886, -87.6412]
                      ]
                    },
                    {
                      "id": 4,
                      "time": "5:00 PM - 7:00 PM",
                      "timeStart": 17,
                      "timeEnd": 19,
                      "activity": "Visit",
                      "place": "Chicago Riverwalk",
                      "address": "Chicago Riverwalk, Chicago, IL 60601",
                      "note": "Scenic walk along the river",
                      "coordinates": [41.8869, -87.6244]
                    },
                    {
                      "id": 5,
                      "time": "7:30 PM - 9:30 PM",
                      "timeStart": 19.5,
                      "timeEnd": 21.5,
                      "activity": "Dinner",
                      "place": "The Gage",
                      "address": "24 S Michigan Ave, Chicago, IL 60603",
                      "note": "Upscale gastropub",
                      "coordinates": [41.8816, -87.6243]
                    }
                  ]
                },
                {
                  "id": 2,
                  "title": "Day 2: Museum Campus & South Loop",
                  "color": "#10b981",
                  "mapView": {
                    "lat": 41.8663,
                    "lng": -87.6170,
                    "zoom": 14
                  },
                  "activities": [
                    {
                      "id": 1,
                      "time": "9:00 AM - 11:30 AM",
                      "timeStart": 9,
                      "timeEnd": 11.5,
                      "activity": "Visit",
                      "place": "Field Museum",
                      "address": "1400 S Lake Shore Dr, Chicago, IL 60605",
                      "note": "Natural history museum",
                      "coordinates": [41.8663, -87.6170]
                    },
                    {
                      "id": 2,
                      "time": "12:00 PM - 1:30 PM",
                      "timeStart": 12,
                      "timeEnd": 13.5,
                      "activity": "Lunch",
                      "place": "Kim and Carlo's Hot Dog Stand",
                      "address": "Museum Campus, Chicago, IL 60605",
                      "note": "Popular hot dog stand near museums",
                      "coordinates": [41.8661, -87.6150]
                    },
                    {
                      "id": 3,
                      "time": "2:00 PM - 4:30 PM",
                      "timeStart": 14,
                      "timeEnd": 16.5,
                      "activity": "Visit",
                      "place": "Shedd Aquarium",
                      "address": "1200 S Lake Shore Dr, Chicago, IL 60605",
                      "note": "One of the largest indoor aquariums",
                      "coordinates": [41.8676, -87.6140]
                    },
                    {
                      "id": 4,
                      "time": "5:00 PM - 6:30 PM",
                      "timeStart": 17,
                      "timeEnd": 18.5,
                      "activity": "Visit",
                      "place": "Grant Park",
                      "address": "337 E Randolph St, Chicago, IL 60601",
                      "note": "Urban park with Buckingham Fountain",
                      "coordinates": [41.8762, -87.6188]
                    },
                    {
                      "id": 5,
                      "time": "7:00 PM - 9:00 PM",
                      "timeStart": 19,
                      "timeEnd": 21,
                      "activity": "Dinner",
                      "place": "Lou Malnati's Pizzeria",
                      "address": "805 S State St, Chicago, IL 60605",
                      "note": "Famous Chicago deep dish pizza",
                      "coordinates": [41.8717, -87.6275]
                    }
                  ]
                },
                {
                  "id": 3,
                  "title": "Day 3: North Side & Lake View",
                  "color": "#f59e0b",
                  "mapView": {
                    "lat": 41.9484,
                    "lng": -87.6553,
                    "zoom": 13
                  },
                  "activities": [
                    {
                      "id": 1,
                      "time": "9:30 AM - 11:30 AM",
                      "timeStart": 9.5,
                      "timeEnd": 11.5,
                      "activity": "Visit",
                      "place": "Lincoln Park Zoo",
                      "address": "2001 N Clark St, Chicago, IL 60614",
                      "note": "Free zoo with diverse animal collection",
                      "coordinates": [41.9217, -87.6337]
                    },
                    {
                      "id": 2,
                      "time": "12:00 PM - 1:30 PM",
                      "timeStart": 12,
                      "timeEnd": 13.5,
                      "activity": "Lunch",
                      "place": "RJ Grunts",
                      "address": "2056 N Lincoln Park W, Chicago, IL 60614",
                      "note": "Classic American restaurant",
                      "coordinates": [41.9227, -87.6352]
                    },
                    {
                      "id": 3,
                      "time": "2:00 PM - 4:00 PM",
                      "timeStart": 14,
                      "timeEnd": 16,
                      "activity": "Visit",
                      "place": "Wrigley Field",
                      "address": "1060 W Addison St, Chicago, IL 60613",
                      "note": "Historic baseball stadium tour",
                      "coordinates": [41.9484, -87.6553]
                    },
                    {
                      "id": 4,
                      "time": "4:30 PM - 6:00 PM",
                      "timeStart": 16.5,
                      "timeEnd": 18,
                      "activity": "Explore",
                      "place": "Wrigleyville",
                      "address": "Wrigleyville, Chicago, IL 60613",
                      "note": "Neighborhood around Wrigley Field",
                      "coordinates": [41.9473, -87.6564]
                    },
                    {
                      "id": 5,
                      "time": "7:00 PM - 9:00 PM",
                      "timeStart": 19,
                      "timeEnd": 21,
                      "activity": "Dinner",
                      "place": "Smoke Daddy",
                      "address": "3636 N Clark St, Chicago, IL 60613",
                      "note": "BBQ and live music",
                      "coordinates": [41.9483, -87.6600]
                    }
                  ]
                },
                {
                  "id": 4,
                  "title": "Day 4: Chicago Heights & Shopping",
                  "color": "#ef4444",
                  "mapView": {
                    "lat": 41.8979,
                    "lng": -87.6236,
                    "zoom": 14
                  },
                  "activities": [
                    {
                      "id": 1,
                      "time": "9:00 AM - 11:30 AM",
                      "timeStart": 9,
                      "timeEnd": 11.5,
                      "activity": "Visit",
                      "place": "Willis Tower Skydeck",
                      "address": "233 S Wacker Dr, Chicago, IL 60606",
                      "note": "Views from glass observation deck",
                      "coordinates": [41.8789, -87.6359]
                    },
                    {
                      "id": 2,
                      "time": "12:00 PM - 2:30 PM",
                      "timeStart": 12,
                      "timeEnd": 14.5,
                      "activity": "Shopping & Lunch",
                      "place": "The Magnificent Mile",
                      "address": "N Michigan Ave, Chicago, IL 60611",
                      "note": "Upscale shopping district",
                      "coordinates": [41.8933, -87.6241]
                    },
                    {
                      "id": 3,
                      "time": "3:00 PM - 5:00 PM",
                      "timeStart": 15,
                      "timeEnd": 17,
                      "activity": "Visit",
                      "place": "Chicago History Museum",
                      "address": "1601 N Clark St, Chicago, IL 60614",
                      "note": "Museum dedicated to Chicago's history",
                      "coordinates": [41.9117, -87.6315]
                    },
                    {
                      "id": 4,
                      "time": "5:30 PM - 6:30 PM",
                      "timeStart": 17.5,
                      "timeEnd": 18.5,
                      "activity": "Visit",
                      "place": "Navy Pier",
                      "address": "600 E Grand Ave, Chicago, IL 60611",
                      "note": "Landmark pier on Lake Michigan",
                      "coordinates": [41.8917, -87.6063]
                    },
                    {
                      "id": 5,
                      "time": "7:00 PM - 9:30 PM",
                      "timeStart": 19,
                      "timeEnd": 21.5,
                      "activity": "Dinner",
                      "place": "Portillo's",
                      "address": "100 W Ontario St, Chicago, IL 60654",
                      "note": "Chicago-style hot dogs and Italian beef",
                      "coordinates": [41.8930, -87.6328]
                    }
                  ]
                }
              ],
              "otherPlaces": [
                {
                  "id": 1,
                  "activity": "Visit",
                  "place": "Art Institute of Chicago",
                  "address": "111 S Michigan Ave, Chicago, IL 60603",
                  "note": "World-class art museum",
                  "coordinates": [41.8796, -87.6237]
                },
                {
                  "id": 2,
                  "activity": "Visit",
                  "place": "360 Chicago Observation Deck",
                  "address": "875 N Michigan Ave, Chicago, IL 60611",
                  "note": "Formerly John Hancock Observatory",
                  "coordinates": [41.8989, -87.6232]
                },
                {
                  "id": 3,
                  "activity": "Explore",
                  "place": "Chinatown",
                  "address": "Chinatown, Chicago, IL 60616",
                  "note": "Chinese cultural area south of downtown",
                  "coordinates": [41.8527, -87.6320]
                },
                {
                  "id": 4,
                  "activity": "Visit",
                  "place": "Adler Planetarium",
                  "address": "1300 S Lake Shore Dr, Chicago, IL 60605",
                  "note": "America's first planetarium",
                  "coordinates": [41.8663, -87.6070]
                },
                {
                  "id": 5,
                  "activity": "Visit",
                  "place": "Museum of Science and Industry",
                  "address": "5700 S Lake Shore Dr, Chicago, IL 60637",
                  "note": "Largest science museum in the Western Hemisphere",
                  "coordinates": [41.7906, -87.5830]
                }
              ]
            };
            
            return Promise.resolve(tripData);
        }

        async function initMap() {
            // Check if the map element exists
            const mapElement = document.getElementById('map');
            if (!mapElement) {
                console.error('Map element not found');
                return;
            }

            // Fetch trip data
            tripData = await fetchTripData();
            if (!tripData) {
                console.error('Failed to load trip data');
                return;
            }

            try {
                // Create Leaflet map centered on Chicago
                map = L.map('map').setView([41.8781, -87.6298], 12);
                
                // Add OpenStreetMap tile layer
                L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19,
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(map);
            } catch (error) {
                console.error('Error initializing map:', error);
                return;
            }

            // Create UI
            createUI();

            // Initialize days for map
            initializeDays();

            // Set up day 1 as default view
            showDayLocations(1);
        }

        function createUI() {
            // Set page title
            document.title = tripData.tripTitle;
            document.querySelector('.page-title').textContent = tripData.tripTitle;
            
            // Create day buttons
            const buttonContainer = document.querySelector('.button-container');
            buttonContainer.innerHTML = '';
            
            tripData.days.forEach(day => {
                const button = document.createElement('button');
                button.onclick = function() { showDayLocations(day.id); };
                button.className = `day-button day-${day.id} ${day.id === 1 ? 'active' : ''}`;
                button.textContent = day.title;
                buttonContainer.appendChild(button);
            });

            // Create day cards and tables
            const container = document.querySelector('.days-container');
            container.innerHTML = '';
            
            tripData.days.forEach(day => {
                // Create day card
                createDayCard(day, container);
            });

            // Create other places card
            createOtherPlacesCard();

            // Create the Kanban board
            createKanbanView();

            // Create the Gantt chart
            createGanttChart();
        }

        function createDayCard(day, container) {
            const dayCard = document.createElement('div');
            dayCard.className = `day-card day-${day.id}`;
            
            const dayTitle = document.createElement('h2');
            dayTitle.className = 'day-title';
            dayTitle.textContent = day.title;
            
            const tableContainer = document.createElement('div');
            tableContainer.className = 'table-container';
            
            const table = document.createElement('table');
            table.className = 'itinerary-table';
            
            // Create table header
            const thead = document.createElement('thead');
            thead.innerHTML = `
                <tr>
                    <th class="number-col">#</th>
                    <th class="time-col">Time</th>
                    <th class="activity-col">Activity</th>
                    <th class="place-col">Place</th>
                    <th class="address-col">Address</th>
                    <th class="note-col">Note</th>
                    <th class="map-link-col">Map</th>
                </tr>
            `;
            
            // Create table body
            const tbody = document.createElement('tbody');
            day.activities.forEach(activity => {
                const tr = document.createElement('tr');
                const mapUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(activity.place + ' ' + activity.address)}`;
                tr.innerHTML = `
                    <td>${activity.id}</td>
                    <td>${activity.time}</td>
                    <td>${activity.activity}</td>
                    <td>${activity.place}</td>
                    <td>${activity.address}</td>
                    <td>${activity.note}</td>
                    <td><a href="${mapUrl}" target="_blank" class="map-link">View</a></td>
                `;
                tbody.appendChild(tr);
            });
            
            table.appendChild(thead);
            table.appendChild(tbody);
            tableContainer.appendChild(table);
            dayCard.appendChild(dayTitle);
            dayCard.appendChild(tableContainer);
            container.appendChild(dayCard);
        }

        function createOtherPlacesCard() {
            const container = document.querySelector('.additional-container');
            if (!container) return;
            
            container.innerHTML = '';
            
            const otherPlacesCard = document.createElement('div');
            otherPlacesCard.className = 'day-card other-places';
            
            const cardTitle = document.createElement('h2');
            cardTitle.className = 'day-title';
            cardTitle.textContent = 'Other Places of Interest in Chicago';
            
            const tableContainer = document.createElement('div');
            tableContainer.className = 'table-container';
            
            const table = document.createElement('table');
            table.className = 'itinerary-table';
            
            // Create table header
            const thead = document.createElement('thead');
            thead.innerHTML = `
                <tr>
                    <th class="number-col">#</th>
                    <th class="activity-col">Suggested Activity</th>
                    <th class="place-col">Place</th>
                    <th class="address-col">Address</th>
                    <th class="note-col">Note</th>
                    <th class="map-link-col">Map</th>
                </tr>
            `;
            
            // Create table body
            const tbody = document.createElement('tbody');
            tripData.otherPlaces.forEach(place => {
                const tr = document.createElement('tr');
                const mapUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(place.place + ' ' + place.address)}`;
                tr.innerHTML = `
                    <td>${place.id}</td>
                    <td>${place.activity}</td>
                    <td>${place.place}</td>
                    <td>${place.address}</td>
                    <td>${place.note}</td>
                    <td><a href="${mapUrl}" target="_blank" class="map-link">View</a></td>
                `;
                tbody.appendChild(tr);
            });
            
            table.appendChild(thead);
            table.appendChild(tbody);
            tableContainer.appendChild(table);
            otherPlacesCard.appendChild(cardTitle);
            otherPlacesCard.appendChild(tableContainer);
            container.appendChild(otherPlacesCard);
        }

        function initializeDays() {
            // Initialize markers and routes for each day
            tripData.days.forEach(day => {
                // Initialize markers array for this day
                dayMarkers[day.id] = [];
                
                // Get coordinates for this day's activities
                const dayCoords = day.activities.map(activity => activity.coordinates);
                
                // Create markers for this day
                createDayMarkers(dayCoords, dayMarkers[day.id], `Day ${day.id}`, day.color, day.activities);
                
                // Check for Chicago River special case
                const riverActivity = day.activities.find(a => a.isRiver);
                if (riverActivity) {
                    addMarkerToChicagoRiver(dayMarkers[day.id], day.color, riverActivity);
                }
                
                // Create routes for this day
                createSimpleRoutes(dayCoords, day.id, day.color);
            });
        }

        function createDayMarkers(coords, markersArray, dayLabel, color, activities) {
            coords.forEach((coord, index) => {
                // Check if this is a river activity (to skip regular marker)
                if (activities && activities[index].isRiver) return;
                
                // Add row number instead of day number
                const rowNumber = index + 1;
                const activity = activities ? activities[index] : null;
                const title = activity ? activity.place : `Location ${index + 1}`;
                
                addMarker(coord[0], coord[1], title, dayLabel, markersArray, color, rowNumber);
            });
        }
        
        // Create simple straight-line routes
        function createSimpleRoutes(coords, dayId, color) {
            if (coords.length < 2) return; // Need at least 2 points for a route
            
            // Create Day route polyline
            const route = L.polyline(coords, {
                color: color,
                weight: 3,
                opacity: 0.7,
                dashArray: '8, 8',
                lineJoin: 'round'
            });
            
            // Store the route
            dayRoutes[dayId] = route;
        }

        function createMarkerIcon(color, text) {
            return L.divIcon({
                className: 'custom-div-icon',
                html: `<div style="background-color: ${color}; width: 30px; height: 30px; display: flex; justify-content: center; align-items: center; border-radius: 50%; color: white; font-weight: bold;">${text}</div>`,
                iconSize: [30, 30],
                iconAnchor: [15, 15]
            });
        }

        function addMarker(lat, lng, title, day, markersArray, color, rowNumber) {
            try {
                // Use row number instead of day number
                const marker = L.marker([lat, lng], {
                    icon: createMarkerIcon(color, rowNumber),
                    title: title
                }).addTo(map).bindPopup(`<b>${title}</b><br>${day} - Stop #${rowNumber}`);
                
                markersArray.push(marker);
            } catch(error) {
                console.error("Error adding marker", error);
            }
        }

        function addMarkerToChicagoRiver(markersArray, color, riverActivity) {
            const riverCoordinates = riverActivity.riverCoordinates;

            // Create polyline
            chicagoRiverPolyline = L.polyline(riverCoordinates, {
                color: '#3498db',
                weight: 4,
                opacity: 0.7,
                lineJoin: 'round'
            }).addTo(map);
            
            // Add a marker at the start of the river
            const marker = L.marker(riverCoordinates[0], {
                icon: createMarkerIcon('#2980b9', riverActivity.id.toString()),
                title: "Chicago River"
            }).addTo(map).bindPopup(`<b>${riverActivity.place}</b><br>${riverActivity.activity} - Stop #${riverActivity.id}`);
            
            markersArray.push(marker);
        }

        function clearMarkers(markers) {
            markers.forEach(marker => {
                map.removeLayer(marker);
            });
        }

        function showDayLocations(dayId) {
            // Find the day data
            const day = tripData.days.find(d => d.id === dayId);
            if (!day) return;

            // Clear all markers
            Object.values(dayMarkers).forEach(markers => clearMarkers(markers));
            
            // Remove river polyline
            if (chicagoRiverPolyline && map.hasLayer(chicagoRiverPolyline)) {
                map.removeLayer(chicagoRiverPolyline);
            }
            
            // Remove all routes
            clearAllRoutes();
            
            // Add this day's markers
            dayMarkers[dayId].forEach(marker => {
                if (!map.hasLayer(marker)) {
                    marker.addTo(map);
                }
            });
            
            // Add this day's route
            if (dayRoutes[dayId]) {
                dayRoutes[dayId].addTo(map);
            }
            
            // Check if this day has the Chicago River and re-add it
            const riverActivity = day.activities.find(a => a.isRiver);
            if (riverActivity && chicagoRiverPolyline && !map.hasLayer(chicagoRiverPolyline)) {
                chicagoRiverPolyline.addTo(map);
            }
            
            // Set map view to this day's focus
            map.setView([day.mapView.lat, day.mapView.lng], day.mapView.zoom);
            
            // Highlight active button
            document.querySelectorAll('.day-button').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.day-${dayId}`).classList.add('active');
        }
        
        // Function to clear all routes
        function clearAllRoutes() {
            Object.values(dayRoutes).forEach(route => {
                if (map.hasLayer(route)) map.removeLayer(route);
            });
        }
        
        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', initMap);

        // Helper function to create Kanban view
        function createKanbanView() {
            const kanbanBoard = document.getElementById('kanban-board');
            if (!kanbanBoard) return;
            
            kanbanBoard.innerHTML = '';
            
            // Create columns for each day
            tripData.days.forEach(day => {
                const column = document.createElement('div');
                column.className = 'kanban-column';
                
                const columnTitle = document.createElement('h3');
                columnTitle.className = `kanban-column-title day-${day.id}-title`;
                columnTitle.textContent = day.title.split(':')[0];
                
                column.appendChild(columnTitle);
                
                // Add cards for each activity
                day.activities.forEach(activity => {
                    const card = document.createElement('div');
                    card.className = 'kanban-card';
                    
                    const timeDiv = document.createElement('div');
                    timeDiv.className = 'kanban-time';
                    timeDiv.textContent = activity.time;
                    
                    const activityDiv = document.createElement('div');
                    activityDiv.className = 'kanban-activity';
                    activityDiv.textContent = activity.activity;
                    
                    const placeDiv = document.createElement('div');
                    placeDiv.className = 'kanban-place';
                    
                    // Create Google Maps URL
                    const mapUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(activity.place + ' ' + activity.address)}`;
                    
                    // Create a hyperlink for the place name
                    placeDiv.innerHTML = `<a href="${mapUrl}" target="_blank" class="place-link">${activity.place}</a>`;
                    
                    card.appendChild(timeDiv);
                    card.appendChild(activityDiv);
                    card.appendChild(placeDiv);
                    
                    column.appendChild(card);
                });
                
                kanbanBoard.appendChild(column);
            });
        }

        // Helper function to create Gantt chart
        function createGanttChart() {
            const ganttContainer = document.getElementById('gantt-container');
            if (!ganttContainer) return;
            
            ganttContainer.innerHTML = '';
            
            // Create header with time markers
            const header = document.createElement('div');
            header.className = 'gantt-header';
            
            const headerLabel = document.createElement('div');
            headerLabel.className = 'gantt-header-label';
            
            const timeline = document.createElement('div');
            timeline.className = 'gantt-timeline';
            
            // Create time markers (9am to 10pm)
            for (let hour = 9; hour <= 22; hour++) {
                const marker = document.createElement('div');
                marker.className = 'gantt-time-marker';
                marker.textContent = hour <= 12 ? `${hour}am` : `${hour-12}pm`;
                timeline.appendChild(marker);
            }
            
            header.appendChild(headerLabel);
            header.appendChild(timeline);
            ganttContainer.appendChild(header);
            
            // Create rows for each day
            tripData.days.forEach(day => {
                const row = document.createElement('div');
                row.className = 'gantt-row';
                
                const rowLabel = document.createElement('div');
                rowLabel.className = `gantt-row-label day-${day.id}-label`;
                rowLabel.textContent = `Day ${day.id}`;
                
                const rowTimeline = document.createElement('div');
                rowTimeline.className = 'gantt-timeline';
                
                // Create activity bars
                day.activities.forEach(activity => {
                    // Calculate position and width based on time
                    // Assuming 9am (9) to 10pm (22) = 0% to 100% of timeline width
                    const timelineStart = 9;  // 9am
                    const timelineEnd = 22;   // 10pm
                    const timelineRange = timelineEnd - timelineStart;
                    
                    const left = ((activity.timeStart - timelineStart) / timelineRange) * 100;
                    const width = ((activity.timeEnd - activity.timeStart) / timelineRange) * 100;
                    
                    const bar = document.createElement('div');
                    bar.className = `gantt-bar day-${day.id}-bar`;
                    bar.style.left = `${left}%`;
                    bar.style.width = `${width}%`;
                    bar.title = `${activity.place}: ${activity.time}`;
                    
                    // Create Google Maps URL
                    const mapUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(activity.place + ' ' + activity.address)}`;
                    
                    // Create a hyperlink for the text within the bar
                    const barText = document.createElement('span');
                    barText.innerHTML = `<a href="${mapUrl}" target="_blank" class="gantt-link">${activity.place.split(' ')[0]}</a>`;  // First word of place
                    
                    bar.appendChild(barText);
                    rowTimeline.appendChild(bar);
                });
                
                row.appendChild(rowLabel);
                row.appendChild(rowTimeline);
                ganttContainer.appendChild(row);
            });
        }
    </script>
</head>
<body class="bg-gray-100">
    <div class="container">
        <h1 class="page-title">Chicago Trip Itinerary with Maps</h1>

        <div id="map" class="map-container"></div>
        <div class="button-container">
            <!-- Day buttons will be dynamically generated -->
        </div>

        <div class="days-container">
            <!-- Day cards will be dynamically generated -->
            </div>
        </div>

    <div class="container additional-container">
        <!-- Other places section will be dynamically generated -->
        </div>

    <div class="container">
        <div class="day-card kanban-view">
            <h2 class="day-title">Timeline View (Kanban Style)</h2>
            <div class="kanban-container">
                <div class="kanban-board" id="kanban-board">
                    <!-- Kanban columns will be dynamically generated -->
                </div>
            </div>
            </div>
        </div>

    <div class="container">
        <div class="day-card gantt-view">
            <h2 class="day-title">Gantt Chart View</h2>
            <div class="gantt-container" id="gantt-container">
                <!-- Gantt chart will be dynamically generated -->
            </div>
        </div>
    </div>

    <style>
    .active {
        box-shadow: var(--shadow);
        transform: translateY(-2px);
    }
    
    .day-1.active {
        background-color: var(--primary-dark);
    }
    
    .day-2.active {
        background-color: var(--secondary-dark);
    }
    
    .day-3.active {
        background-color: var(--accent-dark);
    }
    
    .day-4.active {
        background-color: var(--danger-dark);
    }
    
    .other-places .day-title::before {
        background-color: #6366f1;
    }
    
    /* Kanban Board Styles */
    .kanban-container {
        width: 100%;
        overflow-x: auto;
        padding-bottom: 15px;
    }
    
    .kanban-board {
        display: flex;
        min-width: 100%;
        gap: 15px;
        padding: 10px 0;
    }
    
    .kanban-column {
        flex: 1;
        min-width: 250px;
        background-color: #f8fafc;
        border-radius: 8px;
        padding: 10px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .kanban-column-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 15px;
        padding: 8px;
        text-align: center;
        border-radius: 6px;
        color: white;
    }
    
    .day-1-title {
        background-color: #3b82f6;
    }
    
    .day-2-title {
        background-color: #10b981;
    }
    
    .day-3-title {
        background-color: #f59e0b;
    }
    
    .day-4-title {
        background-color: #ef4444;
    }
    
    .kanban-card {
        background-color: white;
        border-radius: 6px;
        padding: 12px;
        margin-bottom: 10px;
        box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        border-left: 4px solid #e2e8f0;
    }
    
    .kanban-time {
        font-size: 14px;
        font-weight: 600;
        color: #64748b;
        margin-bottom: 5px;
    }
    
    .kanban-activity {
        font-size: 15px;
        font-weight: 600;
        color: #1e293b;
        margin-bottom: 5px;
    }
    
    .kanban-place {
        font-size: 14px;
        color: #475569;
        font-style: italic;
    }
    
    /* Gantt Chart Styles */
    .gantt-container {
        width: 100%;
        overflow-x: auto;
        padding-bottom: 15px;
        margin-top: 10px;
    }
    
    .gantt-header {
        display: flex;
        height: 40px;
        margin-bottom: 8px;
        border-bottom: 1px solid #e2e8f0;
    }
    
    .gantt-header-label {
        width: 100px;
        flex-shrink: 0;
        padding: 8px;
        font-weight: 600;
        color: #334155;
    }
    
    .gantt-timeline {
        position: relative;
        flex-grow: 1;
        min-width: 800px;
        display: flex;
    }
    
    .gantt-time-marker {
        flex: 1;
        text-align: center;
        font-size: 12px;
        color: #64748b;
        border-left: 1px solid #e2e8f0;
        padding-top: 8px;
    }
    
    .gantt-row {
        display: flex;
        height: 50px;
        margin-bottom: 12px;
    }
    
    .gantt-row-label {
        width: 100px;
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        color: white;
        border-radius: 4px;
        margin-right: 6px;
    }
    
    .day-1-label {
        background-color: #3b82f6;
    }
    
    .day-2-label {
        background-color: #10b981;
    }
    
    .day-3-label {
        background-color: #f59e0b;
    }
    
    .day-4-label {
        background-color: #ef4444;
    }
    
    .gantt-bar {
        position: absolute;
        height: 30px;
        top: 10px;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        font-size: 12px;
        color: white;
        font-weight: 500;
        cursor: default;
        transition: all 0.2s ease;
    }
    
    .gantt-bar:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px rgba(0,0,0,0.15);
    }
    
    .gantt-bar span {
        display: inline-block;
        padding: 0 6px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 100%;
    }
    
    .day-1-bar {
        background-color: #93c5fd;
        border: 1px solid #3b82f6;
    }
    
    .day-1-bar:hover {
        background-color: #3b82f6;
    }
    
    .day-2-bar {
        background-color: #6ee7b7;
        border: 1px solid #10b981;
    }
    
    .day-2-bar:hover {
        background-color: #10b981;
    }
    
    .day-3-bar {
        background-color: #fcd34d;
        border: 1px solid #f59e0b;
    }
    
    .day-3-bar:hover {
        background-color: #f59e0b;
    }
    
    .day-4-bar {
        background-color: #fca5a5;
        border: 1px solid #ef4444;
    }
    
    .day-4-bar:hover {
        background-color: #ef4444;
    }
    
    @media (max-width: 768px) {
        .kanban-column {
            min-width: 200px;
        }
        
        .gantt-timeline {
            min-width: 600px;
        }
        
        .gantt-bar {
            font-size: 10px;
        }
        
        .gantt-row-label {
            width: 80px;
        }
        
        .gantt-header-label {
            width: 80px;
        }
    }
    </style>
</body>
</html>
